from unittest import TestCase
import io_framework.csv_fill_data_gaps as fd
import pandas as pd


class TesterStats(TestCase):

    def setUp(self):
        self.number_of_datapoints_in_a_week = 672

        self.number_of_datapoints_in_a_day = 96

        self.test_df_gaps_with_good_start_values = pd.DataFrame({'': ['2016-12-06 00:00:00',
                                                                      '2016-12-06 00:45:00',
                                                                      '2016-12-06 01:00:00',
                                                                      '2016-12-06 01:15:00'
                                                                      ],
                                                                 'avg_hrcrx_max_byt': [1078.903686,
                                                                                       851.9826087,
                                                                                       814.1648936,
                                                                                       1021.485114
                                                                                       ]})

        self.test_df_gaps_with_good_end_values = pd.DataFrame({'': ['2016-12-06 11:30:00',
                                                                    '2016-12-06 12:15:00',
                                                                    '2016-12-06 12:30:00',
                                                                    '2016-12-06 12:45:00'
                                                                    ],
                                                               'avg_hrcrx_max_byt': [1078.903686,
                                                                                     851.9826087,
                                                                                     814.1648936,
                                                                                     1021.485114
                                                                                     ]})

        self.test_df_gaps_with_bad_weekday_start = pd.DataFrame({'': ['2016-12-04 00:00:00',
                                                                      '2016-12-04 00:45:00',
                                                                      '2016-12-04 01:00:00',
                                                                      '2016-12-04 01:15:00',
                                                                      '2016-12-05 00:00:00',
                                                                      '2016-12-05 00:15:00',
                                                                      '2016-12-11 23:30:00',
                                                                      '2016-12-11 23:45:00'
                                                                      ],
                                                                 'avg_hrcrx_max_byt': [1078.903686,
                                                                                       851.9826087,
                                                                                       814.1648936,
                                                                                       1021.485114,
                                                                                       1254.485114,
                                                                                       1987.485114,
                                                                                       906.485114,
                                                                                       998.485114
                                                                                       ]})

        self.test_df_gaps_with_bad_weekday_end = pd.DataFrame({'': ['2016-12-05 00:00:00',
                                                                    '2016-12-05 00:15:00',
                                                                    '2016-12-11 23:30:00',
                                                                    '2016-12-11 23:45:00',
                                                                    '2016-12-12 00:00:00',
                                                                    '2016-12-12 00:15:00',
                                                                    '2016-12-12 00:30:00',
                                                                    ],
                                                               'avg_hrcrx_max_byt': [1078.903686,
                                                                                     851.9826087,
                                                                                     814.1648936,
                                                                                     1021.485114,
                                                                                     1254.485114,
                                                                                     1987.485114,
                                                                                     906.485114
                                                                                     ]})

        self.test_df_gaps_with_only_small_gaps = pd.DataFrame({'': ['2016-12-06 00:00:00',
                                                                    '2016-12-06 01:00:00',
                                                                    '2016-12-06 01:15:00',
                                                                    '2016-12-06 01:30:00',
                                                                    '2016-12-06 01:45:00',
                                                                    '2016-12-06 02:00:00',
                                                                    '2016-12-06 02:15:00',
                                                                    '2016-12-06 02:30:00',
                                                                    '2016-12-06 02:45:00',
                                                                    '2016-12-06 03:00:00',
                                                                    '2016-12-06 03:15:00',
                                                                    '2016-12-06 03:30:00',
                                                                    '2016-12-06 03:45:00',
                                                                    '2016-12-06 04:00:00',
                                                                    '2016-12-06 04:15:00',
                                                                    '2016-12-06 04:30:00',
                                                                    '2016-12-06 04:45:00',
                                                                    '2016-12-06 05:00:00',
                                                                    '2016-12-06 05:15:00',
                                                                    '2016-12-06 05:30:00',
                                                                    '2016-12-06 05:45:00',
                                                                    '2016-12-06 06:00:00',
                                                                    '2016-12-06 06:15:00',
                                                                    '2016-12-06 06:30:00',
                                                                    '2016-12-06 06:45:00',
                                                                    '2016-12-06 07:00:00',
                                                                    '2016-12-06 07:15:00',
                                                                    '2016-12-06 07:30:00',
                                                                    '2016-12-06 07:45:00',
                                                                    '2016-12-06 08:00:00',
                                                                    '2016-12-06 08:15:00',
                                                                    '2016-12-06 08:30:00',
                                                                    '2016-12-06 08:45:00',
                                                                    '2016-12-06 09:00:00',
                                                                    '2016-12-06 09:15:00',
                                                                    '2016-12-06 09:30:00',
                                                                    '2016-12-06 09:45:00',
                                                                    '2016-12-06 10:00:00',
                                                                    '2016-12-06 10:15:00',
                                                                    '2016-12-06 10:30:00',
                                                                    '2016-12-06 10:45:00',
                                                                    '2016-12-06 11:00:00',
                                                                    '2016-12-06 11:15:00',
                                                                    '2016-12-06 11:30:00',
                                                                    '2016-12-06 11:45:00',
                                                                    '2016-12-06 12:00:00',
                                                                    '2016-12-06 12:15:00',
                                                                    '2016-12-06 12:30:00',
                                                                    '2016-12-06 12:45:00',
                                                                    '2016-12-06 13:00:00',
                                                                    '2016-12-06 13:15:00',
                                                                    '2016-12-06 13:30:00',
                                                                    '2016-12-06 13:45:00',
                                                                    '2016-12-06 14:00:00',
                                                                    '2016-12-06 14:15:00',
                                                                    '2016-12-06 14:30:00',
                                                                    '2016-12-06 14:45:00',
                                                                    '2016-12-06 15:00:00',
                                                                    '2016-12-06 15:15:00',
                                                                    '2016-12-06 15:30:00',
                                                                    '2016-12-06 15:45:00',
                                                                    '2016-12-06 16:00:00',
                                                                    '2016-12-06 16:15:00',
                                                                    '2016-12-06 16:30:00',
                                                                    '2016-12-06 16:45:00',
                                                                    '2016-12-06 17:00:00',
                                                                    '2016-12-06 17:15:00',
                                                                    '2016-12-06 17:30:00',
                                                                    '2016-12-06 17:45:00',
                                                                    '2016-12-06 18:00:00',
                                                                    '2016-12-06 18:15:00',
                                                                    '2016-12-06 18:30:00',
                                                                    '2016-12-06 18:45:00',
                                                                    '2016-12-06 19:00:00',
                                                                    '2016-12-06 19:15:00',
                                                                    '2016-12-06 19:30:00',
                                                                    '2016-12-06 19:45:00',
                                                                    '2016-12-06 20:00:00',
                                                                    '2016-12-06 20:15:00',
                                                                    '2016-12-06 20:30:00',
                                                                    '2016-12-06 20:45:00',
                                                                    '2016-12-06 21:00:00',
                                                                    '2016-12-06 21:15:00',
                                                                    '2016-12-06 21:30:00',
                                                                    '2016-12-06 21:45:00',
                                                                    '2016-12-06 22:00:00',
                                                                    '2016-12-06 22:15:00',
                                                                    '2016-12-06 22:30:00',
                                                                    '2016-12-06 22:45:00',
                                                                    '2016-12-06 23:00:00',
                                                                    '2016-12-06 23:45:00'
                                                                    ],
                                                               'avg_hrcrx_max_byt': [1078.903686,
                                                                                     1144.819277,
                                                                                     925.9166667,
                                                                                     936.8003802,
                                                                                     1102.007435,
                                                                                     996.6977186,
                                                                                     1023.67706,
                                                                                     957.6355932,
                                                                                     827.938992,
                                                                                     744.7257282,
                                                                                     760.7943925,
                                                                                     786.6359102,
                                                                                     764.9268293,
                                                                                     727.6585366,
                                                                                     790.5348837,
                                                                                     832.8598901,
                                                                                     678.8655914,
                                                                                     665.9973822,
                                                                                     666.0340909,
                                                                                     655.625714299999,
                                                                                     681.0084746,
                                                                                     775.307926799999,
                                                                                     781.1993769,
                                                                                     781.172727299999,
                                                                                     749.3772455,
                                                                                     745.423676,
                                                                                     793.443038,
                                                                                     766.8142415,
                                                                                     807.8829431,
                                                                                     751.4221557,
                                                                                     769.8151515,
                                                                                     757.339563899999,
                                                                                     718.1424149,
                                                                                     722.252907,
                                                                                     744.4613095,
                                                                                     783.8553846,
                                                                                     770.924471299999,
                                                                                     777.6055046,
                                                                                     808.4625407,
                                                                                     842.6744186,
                                                                                     763.931676999999,
                                                                                     737.5149701,
                                                                                     807.14377,
                                                                                     751.9161677,
                                                                                     748.8571429,
                                                                                     716.2946708,
                                                                                     744.875409799999,
                                                                                     718.2875,
                                                                                     781.0063291,
                                                                                     717.8791541,
                                                                                     700.363076899999,
                                                                                     716.3449367,
                                                                                     709.0566038,
                                                                                     794.2549669,
                                                                                     762.5232198,
                                                                                     831.2818792,
                                                                                     761.9119497,
                                                                                     1275.002165,
                                                                                     1450.529894,
                                                                                     1131.088972,
                                                                                     708.0389785,
                                                                                     579.6514886,
                                                                                     575.785588799999,
                                                                                     593.0412371,
                                                                                     1010.740032,
                                                                                     1167.132616,
                                                                                     2990.11811,
                                                                                     7528.58111099999,
                                                                                     1129.313333,
                                                                                     1274.642222,
                                                                                     1596.473333,
                                                                                     1356.287778,
                                                                                     3072.06422,
                                                                                     1427.751079,
                                                                                     1550.002577,
                                                                                     1572.346915,
                                                                                     1542.858889,
                                                                                     3318.102163,
                                                                                     1066.242938,
                                                                                     1150.294187,
                                                                                     1181.919689,
                                                                                     2335.587319,
                                                                                     1569.106667,
                                                                                     1750.028889,
                                                                                     1160.570701,
                                                                                     1671.089196,
                                                                                     2028.787778,
                                                                                     8981.923333,
                                                                                     2078.068889,
                                                                                     2057.03,
                                                                                     2206.667778
                                                                                     ]})

        self.test_df_gaps_with_large_and_short_gaps = pd.DataFrame({'': ['2016-12-06 00:00:00',
                                                                         '2016-12-06 01:00:00',
                                                                         '2016-12-06 01:15:00',
                                                                         '2016-12-06 01:30:00',
                                                                         '2016-12-06 01:45:00',
                                                                         '2016-12-06 02:00:00',
                                                                         '2016-12-06 02:15:00',
                                                                         '2016-12-06 02:30:00',
                                                                         '2016-12-06 02:45:00',
                                                                         '2016-12-06 03:00:00',
                                                                         '2016-12-06 03:15:00',
                                                                         '2016-12-06 03:30:00',
                                                                         '2016-12-06 03:45:00',
                                                                         '2016-12-06 04:00:00',
                                                                         '2016-12-06 04:15:00',
                                                                         '2016-12-06 04:30:00',
                                                                         '2016-12-06 04:45:00',
                                                                         '2016-12-06 05:00:00',
                                                                         '2016-12-06 05:15:00',
                                                                         '2016-12-06 05:30:00',
                                                                         '2016-12-06 05:45:00',
                                                                         '2016-12-06 06:00:00',
                                                                         '2016-12-06 06:15:00',
                                                                         '2016-12-06 06:30:00',
                                                                         '2016-12-06 06:45:00',
                                                                         '2016-12-06 07:00:00',
                                                                         '2016-12-06 07:15:00',
                                                                         '2016-12-06 07:30:00',
                                                                         '2016-12-06 07:45:00',
                                                                         '2016-12-06 08:00:00',
                                                                         '2016-12-06 08:15:00',
                                                                         '2016-12-06 08:30:00',
                                                                         '2016-12-06 08:45:00',
                                                                         '2016-12-06 09:00:00',
                                                                         '2016-12-06 09:15:00',
                                                                         '2016-12-06 09:30:00',
                                                                         '2016-12-06 09:45:00',
                                                                         '2016-12-06 10:00:00',
                                                                         '2016-12-06 10:15:00',
                                                                         '2016-12-06 10:30:00',
                                                                         '2016-12-06 10:45:00',
                                                                         '2016-12-06 11:00:00',
                                                                         '2016-12-06 11:15:00',
                                                                         '2016-12-06 11:30:00',
                                                                         '2016-12-06 11:45:00',
                                                                         '2016-12-06 12:00:00',
                                                                         '2016-12-06 12:15:00',
                                                                         '2016-12-06 12:30:00',
                                                                         '2016-12-06 12:45:00',
                                                                         '2016-12-06 13:00:00',
                                                                         '2016-12-06 13:15:00',
                                                                         '2016-12-06 13:30:00',
                                                                         '2016-12-06 13:45:00',
                                                                         '2016-12-06 14:00:00',
                                                                         '2016-12-06 14:15:00',
                                                                         '2016-12-06 14:30:00',
                                                                         '2016-12-06 14:45:00',
                                                                         '2016-12-06 15:00:00',
                                                                         '2016-12-06 15:15:00',
                                                                         '2016-12-06 15:30:00',
                                                                         '2016-12-06 15:45:00',
                                                                         '2016-12-06 16:00:00',
                                                                         '2016-12-06 16:15:00',
                                                                         '2016-12-06 16:30:00',
                                                                         '2016-12-06 16:45:00',
                                                                         '2016-12-06 17:00:00',
                                                                         '2016-12-06 17:15:00',
                                                                         '2016-12-06 17:30:00',
                                                                         '2016-12-06 17:45:00',
                                                                         '2016-12-06 18:00:00',
                                                                         '2016-12-06 18:15:00',
                                                                         '2016-12-06 18:30:00',
                                                                         '2016-12-06 18:45:00',
                                                                         '2016-12-06 19:00:00',
                                                                         '2016-12-06 19:15:00',
                                                                         '2016-12-06 19:30:00',
                                                                         '2016-12-06 19:45:00',
                                                                         '2016-12-06 20:00:00',
                                                                         '2016-12-06 20:15:00',
                                                                         '2016-12-06 20:30:00',
                                                                         '2016-12-06 23:45:00'
                                                                         ],
                                                                    'avg_hrcrx_max_byt': [1078.903686,
                                                                                          1144.819277,
                                                                                          925.9166667,
                                                                                          936.8003802,
                                                                                          1102.007435,
                                                                                          996.6977186,
                                                                                          1023.67706,
                                                                                          957.6355932,
                                                                                          827.938992,
                                                                                          744.7257282,
                                                                                          760.7943925,
                                                                                          786.6359102,
                                                                                          764.9268293,
                                                                                          727.6585366,
                                                                                          790.5348837,
                                                                                          832.8598901,
                                                                                          678.8655914,
                                                                                          665.9973822,
                                                                                          666.0340909,
                                                                                          655.625714299999,
                                                                                          681.0084746,
                                                                                          775.307926799999,
                                                                                          781.1993769,
                                                                                          781.172727299999,
                                                                                          749.3772455,
                                                                                          745.423676,
                                                                                          793.443038,
                                                                                          766.8142415,
                                                                                          807.8829431,
                                                                                          751.4221557,
                                                                                          769.8151515,
                                                                                          757.339563899999,
                                                                                          718.1424149,
                                                                                          722.252907,
                                                                                          744.4613095,
                                                                                          783.8553846,
                                                                                          770.924471299999,
                                                                                          777.6055046,
                                                                                          808.4625407,
                                                                                          842.6744186,
                                                                                          763.931676999999,
                                                                                          737.5149701,
                                                                                          807.14377,
                                                                                          751.9161677,
                                                                                          748.8571429,
                                                                                          716.2946708,
                                                                                          744.875409799999,
                                                                                          718.2875,
                                                                                          781.0063291,
                                                                                          717.8791541,
                                                                                          700.363076899999,
                                                                                          716.3449367,
                                                                                          709.0566038,
                                                                                          794.2549669,
                                                                                          762.5232198,
                                                                                          831.2818792,
                                                                                          761.9119497,
                                                                                          1275.002165,
                                                                                          1450.529894,
                                                                                          1131.088972,
                                                                                          708.0389785,
                                                                                          579.6514886,
                                                                                          575.785588799999,
                                                                                          593.0412371,
                                                                                          1010.740032,
                                                                                          1167.132616,
                                                                                          2990.11811,
                                                                                          7528.58111099999,
                                                                                          1129.313333,
                                                                                          1274.642222,
                                                                                          1596.473333,
                                                                                          1356.287778,
                                                                                          3072.06422,
                                                                                          1427.751079,
                                                                                          1550.002577,
                                                                                          1572.346915,
                                                                                          1542.858889,
                                                                                          3318.102163,
                                                                                          1066.242938,
                                                                                          1150.294187,
                                                                                          2206.667778
                                                                                          ]})

    def test_populate_data_gaps_with_no_week_delete_good_start_date(self):
        data = self.test_df_gaps_with_good_start_values
        data = fd.fill_data_gaps(4, num_seq_fill_points=100, init_data=data)
        self.assertEqual(data.shape[0], self.number_of_datapoints_in_a_day, 'An incorrect number of timestamps were added to the data')

    def test_populate_data_gaps_with_no_week_delete_good_end_date(self):
        data = self.test_df_gaps_with_good_end_values
        data = fd.fill_data_gaps(4, num_seq_fill_points=100, init_data=data)
        self.assertEqual(data.shape[0], self.number_of_datapoints_in_a_day, 'An incorrect number of timestamps were added to the data')

    def test_populate_data_gaps_with_no_week_delete_full_day_dataset(self):
        data = self.test_df_gaps_with_only_small_gaps
        data = fd.fill_data_gaps(96, init_data=data)
        self.assertEqual(data.shape[0], self.number_of_datapoints_in_a_day, 'An incorrect number of timestamps were added to the data')

    def test_delete_data_points_when_large_gaps_exist(self):
        data = self.test_df_gaps_with_large_and_short_gaps
        data = fd.fill_data_gaps(96, init_data=data)
        self.assertEqual(data.shape[0], 0, 'An incorrect number of datapoints were removed from the data')

    def test_delete_data_points_when_start_week_date_is_wrong(self):
        data = self.test_df_gaps_with_bad_weekday_start
        data = fd.fill_data_gaps(96, num_seq_fill_points=1000, init_data=data)
        self.assertEqual(data.shape[0], self.number_of_datapoints_in_a_week, 'An incorrect number of datapoints were removed from the data')

    def test_delete_data_points_when_end_week_date_is_wrong(self):
        data = self.test_df_gaps_with_bad_weekday_end
        data = fd.fill_data_gaps(96, num_seq_fill_points=1000, init_data=data)
        self.assertEqual(data.shape[0], self.number_of_datapoints_in_a_week, 'An incorrect number of datapoints were removed from the data')